(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{309:function(a,t,s){"use strict";s.r(t);var e=s(2),r=Object(e.a)({},function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"jvm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm","aria-hidden":"true"}},[a._v("#")]),a._v(" JVM")]),a._v(" "),s("h1",{attrs:{id:"目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#目录","aria-hidden":"true"}},[a._v("#")]),a._v(" 目录")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#JVM%E5%8F%82%E6%95%B0%E7%9A%84%E4%BC%98%E5%8C%96"}},[a._v("JVM参数的优化")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#jstat%E5%91%BD%E4%BB%A4"}},[a._v("jstat命令")])])])]),a._v(" "),s("li",[s("a",{attrs:{href:"#%E7%94%9F%E6%88%90Dump%E6%96%87%E4%BB%B6"}},[a._v("生成Dump文件")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7"}},[a._v("监控工具")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E4%B8%89%E6%96%B9%E5%B7%A5%E5%85%B7"}},[a._v("三方工具")])])])])]),a._v(" "),s("hr"),a._v(" "),s("h2",{attrs:{id:"jvm参数的优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm参数的优化","aria-hidden":"true"}},[a._v("#")]),a._v(" JVM参数的优化")]),a._v(" "),s("h4",{attrs:{id:"因为tomcat运行在java虚拟机之上-适当调整tomcat的运行jvm参数可以提升整体性能。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#因为tomcat运行在java虚拟机之上-适当调整tomcat的运行jvm参数可以提升整体性能。","aria-hidden":"true"}},[a._v("#")]),a._v(" 因为Tomcat运行在JAVA虚拟机之上,适当调整Tomcat的运行JVM参数可以提升整体性能。")]),a._v(" "),s("h3",{attrs:{id:"常用参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用参数","aria-hidden":"true"}},[a._v("#")]),a._v(" 常用参数")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("参数")]),a._v(" "),s("th",[a._v("说明")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("file.encoding")]),a._v(" "),s("td",[a._v("默认文件编码")])]),a._v(" "),s("tr",[s("td",[a._v("-Xmx1024m")]),a._v(" "),s("td",[a._v("初始堆大小为1024m")])]),a._v(" "),s("tr",[s("td",[a._v("-Xms1024m")]),a._v(" "),s("td",[a._v("最大堆大小为1024m")])]),a._v(" "),s("tr",[s("td",[a._v("-Xmn366m")]),a._v(" "),s("td",[a._v("设置年轻代大小为366m,Sun官方推荐配置为整个堆的3/8（35.7%）")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:NewSize=n")]),a._v(" "),s("td",[a._v("设置年轻代大小")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:MaxNewSize=n")]),a._v(" "),s("td",[a._v("设置最大的年轻代大小")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:PermSize=n")]),a._v(" "),s("td",[a._v("JDK1.7设置永久代大小")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:MaxPermSize=n")]),a._v(" "),s("td",[a._v("JDK1.7设置最大永久代大小")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:MetaspaceSize=n")]),a._v(" "),s("td",[a._v("JDK1.8设置元空间大小")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:MaxMetaspaceSize=n")]),a._v(" "),s("td",[a._v("JDK1.8设置最大元空间大小,最好与-XX:MetaspaceSize一致")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:NewRatio=4")]),a._v(" "),s("td",[a._v("设置年轻代（包括Eden和两个Survivor区）与终身代的比值（除去永久代）。设置为4，则年轻代与终身代所占比值为1：4，年轻代占整个堆栈的1/5")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:SurvivorRatio=n")]),a._v(" "),s("td",[a._v("年轻代中Eden区与两个Survivor区的比值。注意Survivor区有两个。如：3，表示Eden：Survivor=3：2，一个Survivor区占整个年轻代的1/5")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:MaxTenuringThreshold")]),a._v(" "),s("td",[a._v("设置垃圾最大年龄，默认为：15。如果设置为0的话，则年轻代对象不经过Survivor区，直接进入年老代。对于年老代比较多的应用，可以提高效率。如果将此值设置为一个较大值，则年轻代对象会在Survivor区进行多次复制，这样可以增加对象再年轻代的存活时间，增加在年轻代即被回收的概论。")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:+CMSScavengeBeforeRemark")]),a._v(" "),s("td",[a._v("CMS并发标记阶段与用户线程并发进行，此阶段会产生已经被标记了的对象又发生变化的情况，若打开此开关，可在一定程度上降低CMS重新标记阶段对上述“又发生变化”对象的扫描时间，当然，“清除尝试”也会消耗一些时间。注：开启此开关并不会保证在标记阶段前一定会进行清除操作")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:+UseSerialGC")]),a._v(" "),s("td",[a._v("设置串行收集器")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:+UseParallelGC")]),a._v(" "),s("td",[a._v("设置并行收集器")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:ParallelGCThreads=n")]),a._v(" "),s("td",[a._v("设置并行收集线程数")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:+UseParalledlOldGC")]),a._v(" "),s("td",[a._v("设置并行年老代收集器")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:+UseConcMarkSweepGC")]),a._v(" "),s("td",[a._v("设置并发收集器")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:MaxGCPauseMillis=n")]),a._v(" "),s("td",[a._v("设置并行收集最大暂停时间")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:GCTimeRatio=n")]),a._v(" "),s("td",[a._v("设置垃圾回收时间占程序运行时间的百分比。公式为1/(1+n)")])]),a._v(" "),s("tr",[s("td",[a._v("-XX:+UseConcMarkSweepGC")]),a._v(" "),s("td",[a._v("设置年老代为并发收集。测试中配置这个以后，-XX:NewRatio=4的配置失效了，原因不明。所以，此时年轻代大小最好用-Xmn设置。")])])])]),a._v(" "),s("h3",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[a._v("#")]),a._v(" 参考")]),a._v(" "),s("h4",{attrs:{id:"根据jdk8-4g内存-4核生成的jvm参数，打印了gc各个阶段的日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#根据jdk8-4g内存-4核生成的jvm参数，打印了gc各个阶段的日志","aria-hidden":"true"}},[a._v("#")]),a._v(" 根据JDK8-4G内存-4核生成的jvm参数，打印了gc各个阶段的日志")]),a._v(" "),s("h5",{attrs:{id:"看看ygc-的回收时间及-时间，已及old区大小，最后看fgc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#看看ygc-的回收时间及-时间，已及old区大小，最后看fgc","aria-hidden":"true"}},[a._v("#")]),a._v(" 看看ygc 的回收时间及 时间，已及old区大小，最后看FGC")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("export")]),a._v(" JAVA_OPTS"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"\n-server\n-Xmx2688M\n-Xms2688M\n-Xmn960m\n-XX:MaxMetaspaceSize=512M\n-XX:MetaspaceSize=512M\n-XX:+UseConcMarkSweepGC\n-XX:+UseCMSInitiatingOccupancyOnly\n-XX:CMSInitiatingOccupancyFraction=70\n-XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses\n-XX:+CMSClassUnloadingEnabled\n-XX:+ParallelRefProcEnabled\n-XX:+CMSScavengeBeforeRemark\n-XX:+HeapDumpOnOutOfMemoryError\n-XX:HeapDumpPath=/home/jvm_logs/local\n-XX:ErrorFile=/home/jvm_logs/hs_err_pid%p.log\n-Xloggc:/home/jvm_logs/gc.log\n-Djava.rmi.server.hostname=192.168.1.220\n-Dcom.sun.management.jmxremote.port=18999\n-Dcom.sun.management.jmxremote.ssl=false\n-Dcom.sun.management.jmxremote.authenticate=false\n-XX:+PrintGCDetails\n-XX:+PrintGCDateStamps\n-verbose:class\n-XX:+PrintClassHistogramBeforeFullGC\n-XX:+PrintClassHistogramAfterFullGC\n-XX:+PrintCommandLineFlags\n-XX:+PrintGCApplicationConcurrentTime\n-XX:+PrintGCApplicationStoppedTime\n-XX:+PrintTenuringDistribution\n-XX:+PrintHeapAtGC\n"')]),a._v("\n")])])]),s("h3",{attrs:{id:"windows"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#windows","aria-hidden":"true"}},[a._v("#")]),a._v(" windows")]),a._v(" "),s("h4",{attrs:{id:"添加java-home和jre-home"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加java-home和jre-home","aria-hidden":"true"}},[a._v("#")]),a._v(" 添加JAVA_HOME和JRE_HOME")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("set")]),a._v(" JAVA_HOME"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("C:\\Program Files\\Java\\jdk1.8.0_191\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("set")]),a._v(" JRE_HOME"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("C:\\Program Files\\Java\\jre1.8.0_201\n")])])]),s("h4",{attrs:{id:"修改bin-catalina-bat文件-在setlocal下面一行添加，注意代码格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改bin-catalina-bat文件-在setlocal下面一行添加，注意代码格式","aria-hidden":"true"}},[a._v("#")]),a._v(" 修改bin/catalina.bat文件,在setlocal下面一行添加，注意代码格式")]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/Tomcat%E4%BF%AE%E6%94%B9JVM%E5%8F%82%E6%95%B0Windows.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"linux"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux","aria-hidden":"true"}},[a._v("#")]),a._v(" linux")]),a._v(" "),s("h4",{attrs:{id:"修改bin-catalina-sh文件-在最前面添加，注意代码格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改bin-catalina-sh文件-在最前面添加，注意代码格式","aria-hidden":"true"}},[a._v("#")]),a._v(" 修改bin/catalina.sh文件,在最前面添加，注意代码格式")]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/Tomcat%E4%BF%AE%E6%94%B9JVM%E5%8F%82%E6%95%B0Linux.png",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"jstat命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jstat命令","aria-hidden":"true"}},[a._v("#")]),a._v(" jstat命令")]),a._v(" "),s("blockquote",[s("p",[a._v("jstat [ generalOption | outputOptions vmid [interval[s|ms] [count]] ]")]),a._v(" "),s("p",[a._v("参数：")]),a._v(" "),s("blockquote",[s("p",[a._v("generalOption: 一般使用-gcutil查看GC情况")]),a._v(" "),s("p",[a._v("vmid: 虚拟机进程号，即当前运行的java进程号")]),a._v(" "),s("p",[a._v("interval: 间隔时间，单位为秒或毫秒")]),a._v(" "),s("p",[a._v("count: 打印次数，如果缺省则打印无数次")])])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 每2秒输出一次内存情况，连续输出100次")]),a._v("\njstat -gcutil "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("pid"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" 2000 100\njstat -gcutil "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("pgrep java"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" 2000 100\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 输出heap各个分区大小")]),a._v("\njstat -gc "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("pid"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\njstat -gc "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("pgrep java"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 获取到线程的dump日志")]),a._v("\njstack -l "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("pgrep java"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" dump.log\n")])])]),s("h3",{attrs:{id:"观察jvm中当前所有线程的运行情况和线程当前状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#观察jvm中当前所有线程的运行情况和线程当前状态","aria-hidden":"true"}},[a._v("#")]),a._v(" 观察jvm中当前所有线程的运行情况和线程当前状态")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("jstack -F 进程ID\njstack -F "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("pgrep java"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将所有线程信息输入到指定文件中")]),a._v("\njstack -F 进程ID "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" jvm.log\njstack -F "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("pgrep java"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" jvm.log\n")])])]),s("h2",{attrs:{id:"other"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#other","aria-hidden":"true"}},[a._v("#")]),a._v(" other")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看本机所有java进程pid")]),a._v("\njps -l\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看运行时jvm参数")]),a._v("\njinfo -flag "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("jvm参数"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("pid"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 获取当前JVM默认参数")]),a._v("\njava -XX:+PrintFlagsFinal -version "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" MaxHeapSize\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 找出占用cpu高（或执行时间长）的线程pid ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("top")]),a._v(" -H -p "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("pid"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("top")]),a._v(" -H -p "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("pgrep java"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 打印等待回收的对象信息")]),a._v("\njmap -finalizerinfo "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("pid"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\njmap -finalizerinfo "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("pgrep java"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n")])])]),s("p",[s("a",{attrs:{href:"https://www.cnblogs.com/myna/p/7573843.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("JVM调优命令-jmap"),s("OutboundLink")],1)]),a._v(" "),s("h2",{attrs:{id:"生成dump文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生成dump文件","aria-hidden":"true"}},[a._v("#")]),a._v(" 生成Dump文件")]),a._v(" "),s("h3",{attrs:{id:"jvm在遇到oom-outofmemoryerror-时生成dump文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm在遇到oom-outofmemoryerror-时生成dump文件","aria-hidden":"true"}},[a._v("#")]),a._v(" JVM在遇到OOM(OutOfMemoryError)时生成Dump文件")]),a._v(" "),s("h3",{attrs:{id:"命令："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#命令：","aria-hidden":"true"}},[a._v("#")]),a._v(" 命令：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("jmap -dump:live,format"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("b,file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("d:\\dump\\heap.hprof "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("pid"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("blockquote",[s("p",[a._v("file：保存路径及文件名")]),a._v(" "),s("p",[a._v("pid：进程编号（windows通过任务管理器查看，linux通过ps aux查看）")]),a._v(" "),s("p",[a._v("dump文件可以通过MemoryAnalyzer(MAT)分析查看,可以查看dump时对象数量，内存占用，线程情况等。")])]),a._v(" "),s("h2",{attrs:{id:"监控工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#监控工具","aria-hidden":"true"}},[a._v("#")]),a._v(" 监控工具")]),a._v(" "),s("h3",{attrs:{id:"jvisualvm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvisualvm","aria-hidden":"true"}},[a._v("#")]),a._v(" jvisualvm")]),a._v(" "),s("h4",{attrs:{id:"在jvm启动参数中加入或在tomcat的-bin-catalina-sh文件中加入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在jvm启动参数中加入或在tomcat的-bin-catalina-sh文件中加入","aria-hidden":"true"}},[a._v("#")]),a._v(" 在jvm启动参数中加入或在Tomcat的/bin/catalina.sh文件中加入")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("-Djava.rmi.server.hostname"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("主机的IP\n-Dcom.sun.management.jmxremote.port"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("18999\n-Dcom.sun.management.jmxremote.ssl"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\n-Dcom.sun.management.jmxremote.authenticate"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\n")])])]),s("h4",{attrs:{id:"启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动","aria-hidden":"true"}},[a._v("#")]),a._v(" 启动")]),a._v(" "),s("blockquote",[s("p",[a._v("到JDK安装目录/bin目录下，双击jvisualvm.exe文件启动")]),a._v(" "),s("p",[a._v("C:\\Program Files\\Java\\jdk1.8.0_191\\bin目录下找到jvisualvm.exe")])]),a._v(" "),s("h4",{attrs:{id:"需要注意的是-当os所在分区是fat格式时，visualvm无法获取相关信息！"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#需要注意的是-当os所在分区是fat格式时，visualvm无法获取相关信息！","aria-hidden":"true"}},[a._v("#")]),a._v(" 需要注意的是:当OS所在分区是FAT格式时，VisualVM无法获取相关信息！")]),a._v(" "),s("p",[a._v("http://blog.51cto.com/zero01/2141942")]),a._v(" "),s("p",[a._v("https://blog.csdn.net/u010004317/article/details/82948040")]),a._v(" "),s("h3",{attrs:{id:"解决visual-gc提示”不受此jvm支持“，要监控的主机没有配置jstatd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决visual-gc提示”不受此jvm支持“，要监控的主机没有配置jstatd","aria-hidden":"true"}},[a._v("#")]),a._v(" 解决Visual GC提示”不受此JVM支持“，要监控的主机没有配置jstatd")]),a._v(" "),s("h4",{attrs:{id:"先查看jstatd服务是否可用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#先查看jstatd服务是否可用","aria-hidden":"true"}},[a._v("#")]),a._v(" 先查看jstatd服务是否可用")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("jps -l 127.0.0.1\n")])])]),s("h4",{attrs:{id:"一、在原有配置文件java-policy中添加"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、在原有配置文件java-policy中添加","aria-hidden":"true"}},[a._v("#")]),a._v(" 一、在原有配置文件"),s("code",[a._v("java.policy")]),a._v("中添加")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_HOME")]),a._v("/jre/lib/security/java.policy\n")])])]),s("h5",{attrs:{id:"在文件末位的-前添加"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在文件末位的-前添加","aria-hidden":"true"}},[a._v("#")]),a._v(" 在文件末位的 "),s("code",[a._v("};")]),a._v(" 前添加")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("permission java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("security"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AllPermission")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h5",{attrs:{id:"启动jstatd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动jstatd","aria-hidden":"true"}},[a._v("#")]),a._v(" 启动jstatd")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_HOME")]),a._v("/bin\n./jstatd -J-Djava.security.policy"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("all.policy -J-Djava.rmi.server.hostname"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("本服务器IP -p 端口 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])])]),s("h5",{attrs:{id:"查看运行端口情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看运行端口情况","aria-hidden":"true"}},[a._v("#")]),a._v(" 查看运行端口情况")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("netstat")]),a._v(" -anp "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" jstatd\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("netstat")]),a._v(" -ntlp\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("lsof")]),a._v(" -i:1099\n")])])]),s("h4",{attrs:{id:"二、（推荐）新建一个配置文件jstatd-all-policy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、（推荐）新建一个配置文件jstatd-all-policy","aria-hidden":"true"}},[a._v("#")]),a._v(" 二、（推荐）新建一个配置文件"),s("code",[a._v("jstatd.all.policy")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_HOME")]),a._v("/bin/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" jstatd.all.policy\n")])])]),s("h5",{attrs:{id:"添加以下代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加以下代码","aria-hidden":"true"}},[a._v("#")]),a._v(" 添加以下代码")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("grant codebase "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"file:${java.home}/../lib/tools.jar"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n   permission java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("security"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AllPermission")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h5",{attrs:{id:"给文件加上执行权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#给文件加上执行权限","aria-hidden":"true"}},[a._v("#")]),a._v(" 给文件加上执行权限")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x jstatd.all.policy\n")])])]),s("h5",{attrs:{id:"在java的bin目录下用以下命令启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在java的bin目录下用以下命令启动","aria-hidden":"true"}},[a._v("#")]),a._v(" 在Java的bin目录下用以下命令启动")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("./jstatd -J-Djava.security.policy"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("jstatd.all.policy -J-Djava.rmi.server.hostname"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("本服务器IP -p 端口 -J-Djava.rmi.server.logCalls"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])])]),s("blockquote",[s("p",[a._v("-J-Djava.security.policy=jstatd.all.policy 文件的绝对路径；")]),a._v(" "),s("p",[a._v("-J-Djava.rmi.server.logCalls=true 打开日志,如果客户端有连接过来的请求,可以监控到,便于排错；")]),a._v(" "),s("p",[a._v("-J-Djava.rmi.server.hostname=本服务器IP 指明本机 hostname 对应的本机地址,确保该地址可以给客户机访问。\n因为有的服务器 hostname 对应的 ip 不一定是外网能连上的，最好在这里直接明确指定；")]),a._v(" "),s("p",[a._v("-p 3333 指定服务的端口号，默认是1099。也是可选参数。")])]),a._v(" "),s("p",[a._v("https://blog.csdn.net/liupeifeng3514/article/details/78998161")]),a._v(" "),s("h3",{attrs:{id:"jconsole"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jconsole","aria-hidden":"true"}},[a._v("#")]),a._v(" jconsole")]),a._v(" "),s("h4",{attrs:{id:"查看hostname"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看hostname","aria-hidden":"true"}},[a._v("#")]),a._v(" 查看hostname")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("hostname")]),a._v(" -i\n")])])]),s("blockquote",[s("h4",{attrs:{id:"如果hostname为127-0-0-1就需要修改"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如果hostname为127-0-0-1就需要修改","aria-hidden":"true"}},[a._v("#")]),a._v(" 如果hostname为127.0.0.1就需要修改")])]),a._v(" "),s("h4",{attrs:{id:"修改hostname"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改hostname","aria-hidden":"true"}},[a._v("#")]),a._v(" 修改hostname")]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("vi /etc/hosts")]),a._v("将其第一行"),s("code",[a._v("127.0.0.1 localhost.localdomain localhost")]),a._v("中的"),s("code",[a._v("127.0.0.1")]),a._v("修改为："),s("code",[a._v("本服务器IP")])]),a._v(" "),s("p",[a._v("重启Linux，在服务器上输入"),s("code",[a._v("hostname -i")]),a._v("，查看实际设置的IP地址是否为你设置的")])]),a._v(" "),s("h4",{attrs:{id:"启动服务的参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动服务的参数","aria-hidden":"true"}},[a._v("#")]),a._v(" 启动服务的参数")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("java -jar -Djava.rmi.server.hostname"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("本服务器IP -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("端口 -Dcom.sun.management.jmxremote.ssl"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false -Dcom.sun.management.jmxremote.authenticate"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false jar包\n")])])]),s("h3",{attrs:{id:"远程debug"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#远程debug","aria-hidden":"true"}},[a._v("#")]),a._v(" 远程Debug")]),a._v(" "),s("h4",{attrs:{id:"启动参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动参数","aria-hidden":"true"}},[a._v("#")]),a._v(" 启动参数")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("java -Djavax.net.debug"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("all -Xdebug -Xnoagent -Djava.compiler"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("NONE -Xrunjdwp:transport"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("dt_socket,server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("y,suspend"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("n,address"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("端口 -jar jar包\n")])])]),s("h4",{attrs:{id:"参数说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参数说明","aria-hidden":"true"}},[a._v("#")]),a._v(" 参数说明")]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("-Djavax.net.debug")]),a._v(" 查看调试信息")]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("all")]),a._v(" 代表所有，其他有"),s("code",[a._v("SSL")]),a._v(","),s("code",[a._v("handshake")]),a._v(","),s("code",[a._v("date")]),a._v(","),s("code",[a._v("trust manager")])])]),a._v(" "),s("p",[s("code",[a._v("-Xdebug")]),a._v(" 是通知JVM工作在DEBUG模式下\n"),s("code",[a._v("-Xnoagent")]),a._v(" 禁用默认sun.tools.debug调试器。")]),a._v(" "),s("p",[s("code",[a._v("-Djava.compiler=NONE")]),a._v(" 为了加快debug的速度，禁止JIT编译器的加载，"),s("a",{attrs:{href:"https://www.iteye.com/problems/89141",target:"_blank",rel:"noopener noreferrer"}},[a._v("详细说明"),s("OutboundLink")],1)]),a._v(" "),s("p",[s("code",[a._v("-Xrunjdwp")]),a._v(" 是通知JVM使用(Java debug wire protocol)来运行调试环境。该参数同时了一系列的调试选项：")]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("transport")]),a._v("指定了调试数据的传送方式，"),s("code",[a._v("dt_socket")]),a._v("是指用SOCKET模式，"),s("code",[a._v("dt_shmem")]),a._v("指用共享内存方式，"),s("code",[a._v("dt_shmem")]),a._v("只适用于Windows平台。")])]),a._v(" "),s("p",[s("code",[a._v("server=y/n")]),a._v(" VM是否需要作为调试服务器执行。")]),a._v(" "),s("p",[s("code",[a._v("suspend=y/n")]),a._v(" 是否在调试客户端建立连接之后启动 VM 。(设置为y时启动不了)")]),a._v(" "),s("p",[s("code",[a._v("onthrow=java.io.IOException")]),a._v(" 指明，当产生该类型的Exception时，JVM就会中断下来，进行调式。可选参数")]),a._v(" "),s("p",[s("code",[a._v("launch=/sbin/echo")]),a._v(" 指明，当JVM被中断下来时，执行的可执行程序。可选参数")]),a._v(" "),s("p",[s("code",[a._v("onuncaught=y/n")]),a._v(" 指明，出现uncaught exception 后，是否中断JVM的执行.")])]),a._v(" "),s("h4",{attrs:{id:"客户端使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端使用","aria-hidden":"true"}},[a._v("#")]),a._v(" 客户端使用")]),a._v(" "),s("blockquote",[s("h4",{attrs:{id:"在idea中，点击顶部菜单run点击edit-configuration按钮-出现弹窗，点击-按钮，找到remote选项。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在idea中，点击顶部菜单run点击edit-configuration按钮-出现弹窗，点击-按钮，找到remote选项。","aria-hidden":"true"}},[a._v("#")]),a._v(" 在IDEA中，点击顶部菜单"),s("code",[a._v("Run")]),a._v("点击"),s("code",[a._v("Edit Configuration")]),a._v("按钮--\x3e出现弹窗，点击"),s("code",[a._v("+")]),a._v("按钮，找到"),s("code",[a._v("Remote")]),a._v("选项。")]),a._v(" "),s("h4",{attrs:{id:"在name中填入remote项目名称，在host中填ip地址，在port中填端口号，在use-module-classpath选择远程调试的项目module，配置完成后点击ok即可"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在name中填入remote项目名称，在host中填ip地址，在port中填端口号，在use-module-classpath选择远程调试的项目module，配置完成后点击ok即可","aria-hidden":"true"}},[a._v("#")]),a._v(" 在"),s("code",[a._v("Name")]),a._v("中填入Remote项目名称，在"),s("code",[a._v("Host")]),a._v("中填IP地址，在"),s("code",[a._v("Port")]),a._v("中填端口号，在"),s("code",[a._v("Use Module classpath")]),a._v("选择远程调试的项目module，配置完成后点击OK即可")]),a._v(" "),s("p",[a._v("启动项目时选择刚刚填的Remote项目名称")])]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/IDEA%E8%BF%9C%E7%A8%8Bdebug%E8%B0%83%E8%AF%95.png",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"三方工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三方工具","aria-hidden":"true"}},[a._v("#")]),a._v(" 三方工具")]),a._v(" "),s("h3",{attrs:{id:"无侵入式的jvm监控工具myperf4j"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#无侵入式的jvm监控工具myperf4j","aria-hidden":"true"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://github.com/ThinkpadNC5/MyPerf4J",target:"_blank",rel:"noopener noreferrer"}},[a._v("无侵入式的jvm监控工具MyPerf4J"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"alibaba-java诊断利器arthas"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#alibaba-java诊断利器arthas","aria-hidden":"true"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://github.com/alibaba/arthas",target:"_blank",rel:"noopener noreferrer"}},[a._v("Alibaba Java诊断利器Arthas"),s("OutboundLink")],1)])])},[],!1,null,null,null);t.default=r.exports}}]);